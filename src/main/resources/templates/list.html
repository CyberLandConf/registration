{#include template.html}
{#body}
<div class="container">
    {#include logoheader.html/}
    <h2 class="font-weight-light my-3">Anmeldungen für Event am {event.startDate}: {registrations.size}</h2>
    <h3 class="font-weight-light my-3"><a href="{event.url}" target="_blank">{event.summary}</a></h3>
    <table class="table table-striped table-sm">
        <thead>
        <tr>
            <th>Lfd.Nr.</th>
            <th>Name</th>
            <th>E-Mail</th>
            <th>Stammtisch</th>
            <th>Warteliste</th>
            <th>Datum</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        {#for reg in registrations}
            <tr id="{reg.id}">
                <td>{count}</td>
                <td>{reg.name}</td>
                <td><a href="mailto:{reg.email}">{reg.email}</a></td>
                <td>
                    {#if reg.pub}<img src="/webjars/bootstrap-icons/icons/check.svg" alt=""/>{/if}
                </td>
                <td>
                    {#if reg.waitlist}<img src="/webjars/bootstrap-icons/icons/hourglass-split.svg" alt=""/>{/if}
                </td>
                <td>{reg.formattedCreationDate}</td>
                <td>
                    <img src="/webjars/bootstrap-icons/icons/trash.svg" alt="" onclick="delReg('{reg.id}', '{reg.name}')" style="cursor: pointer"/>
                </td>
            </tr>
        {/for}
        </tbody>
    </table>
    <div class="my-3">
        <button class="btn btn-sm btn-outline-danger" data-toggle="collapse" data-target="#collapseEmails">
            Zeige Namen und E-Mails kopierbar
        </button>
        <div class="collapse" id="collapseEmails">
            <div class="form-group">
                <label for="names">Namen</label>
                <textarea id="names" class="form-control" rows="5">{#for reg in registrations}{reg.name}
{/for}</textarea>
            </div>
            <div class="form-group">
                <label for="emails">E-Mails</label>
                <textarea id="emails" class="form-control" rows="5">{#for reg in registrations}{reg.email}, {/for}</textarea>
            </div>
        </div>
    </div>
    <div class="my-3">
        <button class="btn btn-sm btn-outline-primary" data-toggle="collapse" data-target="#collapseEventData">
            Zusätzliche Event-Daten
        </button>
        <div class="collapse" id="collapseEventData">
            <form onsubmit="return submitEventData()">
                <div class="form-group row">
                    <label for="webinarLink" class="col-2 col-form-label">Webinar-Link</label>
                    <div class="col-10">
                        <input type="text" class="form-control" id="webinarLink" value="{eventData.get('webinarLink')}">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Seichern</button>
            </form>
        </div>
    </div>
</div>
<script src="/webjars/jquery/jquery.min.js"></script>
<script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
<script>
    function delReg(id, name) {
        if (confirm('Delete registration of ' + name + '?')) {
            console.log('deleting registration', id);
            $.ajax({
                url: '/delete?id=' + id,
                type: 'DELETE'
            }).done(function () {
                $('#' + id).remove();
            });
        }
    }
    function submitEventData() {
        const data = {
            webinarLink: $('#webinarLink').val()
        };
        $.ajax({
            url: '{eventId}',
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(data),
        }).done(function() {
            alert('Event-Daten gespeichert.');
        });
        return false;
    }
</script>
{/body}
{/include}
